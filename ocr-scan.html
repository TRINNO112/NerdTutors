<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR Scan & Evaluate | NerdTutors</title>
    <meta name="description" content="Scan your handwritten answer sheets and get AI-powered evaluation instantly.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Modular CSS -->
    <link rel="stylesheet" href="ocr-scan-base.css">
    <link rel="stylesheet" href="ocr-scan-components.css">
    <link rel="stylesheet" href="ocr-scan-results.css">
    <link rel="stylesheet" href="ocr-scan-animations.css">
</head>

<body>
    <!-- ==================== HEADER ==================== -->
    <header class="ocr-header">
        <div class="ocr-header-content">
            <a href="index.html" class="ocr-back-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                Back to Home
            </a>
            <h1 class="ocr-page-title">
                <span class="ocr-title-icon">üì∏</span>
                OCR Scan & Evaluate
            </h1>
            <div class="ocr-header-badge">AI-Powered</div>
        </div>
    </header>

    <!-- ==================== MAIN CONTENT ==================== -->
    <main class="ocr-main">

        <!-- ===== MODE SELECTOR ===== -->
        <section class="ocr-mode-selector" id="modeSelector">
            <h2 class="ocr-section-title">Choose Scan Mode</h2>
            <p class="ocr-section-desc">Select how you want to scan your answers</p>
            <div class="ocr-mode-cards">
                <!-- Single Answer Mode -->
                <div class="ocr-mode-card" id="singleModeCard" data-mode="single">
                    <div class="ocr-mode-icon">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2" />
                            <path d="M9 12l2 2 4-4" />
                        </svg>
                    </div>
                    <h3>Single Answer</h3>
                    <p>Upload one photo per question for precise evaluation</p>
                    <div class="ocr-mode-tags">
                        <span class="ocr-tag">High Accuracy</span>
                        <span class="ocr-tag">Per Question</span>
                    </div>
                </div>
                <!-- Full Sheet Mode -->
                <div class="ocr-mode-card" id="fullSheetModeCard" data-mode="full-sheet">
                    <div class="ocr-mode-icon">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                            <polyline points="14,2 14,8 20,8" />
                            <line x1="16" y1="13" x2="8" y2="13" />
                            <line x1="16" y1="17" x2="8" y2="17" />
                            <line x1="10" y1="9" x2="8" y2="9" />
                        </svg>
                    </div>
                    <h3>Full Answer Sheet</h3>
                    <p>Upload entire answer sheet ‚Äî AI identifies each answer automatically</p>
                    <div class="ocr-mode-tags">
                        <span class="ocr-tag">Multiple Answers</span>
                        <span class="ocr-tag">Auto-Detect</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== SINGLE ANSWER FLOW ===== -->
        <section class="ocr-flow-section" id="singleFlow" style="display: none;">
            <div class="ocr-flow-header">
                <button class="ocr-flow-back" id="singleFlowBack">‚Üê Change Mode</button>
                <h2 class="ocr-section-title">Single Answer Scan</h2>
                <div class="ocr-step-indicator">
                    <span class="ocr-step active" data-step="1">1. Select Batch</span>
                    <span class="ocr-step-divider">‚Üí</span>
                    <span class="ocr-step" data-step="2">2. Upload</span>
                    <span class="ocr-step-divider">‚Üí</span>
                    <span class="ocr-step" data-step="3">3. Results</span>
                </div>
            </div>

            <!-- Step 1: Select Batch (students see questions FIRST) -->
            <div class="ocr-step-panel" id="singleStep1">
                <div class="ocr-context-form">
                    <div class="ocr-form-group">
                        <label class="ocr-label" for="singleBatchSelect">Select Question Batch <span
                                class="ocr-required">*</span></label>
                        <select id="singleBatchSelect" class="ocr-input"
                            style="padding: 0.75rem; font-size: 1rem; width: 100%;">
                            <option value="">-- Loading batches... --</option>
                        </select>
                    </div>
                    <!-- Batch Preview -->
                    <div id="singleBatchPreview" style="display: none; margin-top: 1rem;">
                        <div
                            style="background: #f0f4ff; border-radius: 12px; padding: 1rem; border: 1px solid #d0d8ee;">
                            <div style="font-weight: 700; color: #1e3c72; margin-bottom: 0.5rem;" id="singleBatchName">
                                Batch Name</div>
                            <div
                                style="display: flex; gap: 1rem; font-size: 0.85rem; color: #666; margin-bottom: 0.75rem;">
                                <span>üìù <strong id="singleBatchQCount">0</strong> Questions</span>
                                <span>üéØ <strong id="singleBatchMarks">0</strong> Total Marks</span>
                            </div>
                            <div id="singleBatchQuestions" style="font-size: 0.8rem; color: #555;"></div>
                        </div>
                    </div>
                </div>
                <button class="ocr-btn ocr-btn-primary ocr-btn-full" id="singleNextStep1" disabled>
                    Continue to Upload Answer ‚Üí
                </button>
            </div>

            <!-- Step 2: Upload Answer Photo -->
            <div class="ocr-step-panel" id="singleStep2" style="display: none;">
                <div class="ocr-upload-zone" id="singleUploadZone">
                    <div class="ocr-upload-content" id="singleUploadContent">
                        <div class="ocr-upload-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" />
                                <polyline points="17 8 12 3 7 8" />
                                <line x1="12" y1="3" x2="12" y2="15" />
                            </svg>
                        </div>
                        <h3>Upload Answer Photo</h3>
                        <p>Drag & drop your image here, or click to browse</p>
                        <div class="ocr-upload-actions">
                            <button class="ocr-btn ocr-btn-primary" id="singleFileBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" />
                                    <polyline points="17 8 12 3 7 8" />
                                    <line x1="12" y1="3" x2="12" y2="15" />
                                </svg>
                                Choose File
                            </button>
                            <button class="ocr-btn ocr-btn-secondary" id="singleCameraBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z" />
                                    <circle cx="12" cy="13" r="4" />
                                </svg>
                                Take Photo
                            </button>
                        </div>
                    </div>
                    <!-- Image Preview (shown after upload) -->
                    <div class="ocr-image-preview" id="singleImagePreview" style="display: none;">
                        <img id="singlePreviewImg" alt="Uploaded answer" />
                        <div class="ocr-preview-overlay">
                            <button class="ocr-btn ocr-btn-small" id="singleChangeImg">Change Image</button>
                        </div>
                    </div>
                </div>
                <input type="file" id="singleFileInput" accept="image/*" style="display: none;">
                <input type="file" id="singleCameraInput" accept="image/*" capture="environment" style="display: none;">
                <div class="ocr-btn-row">
                    <button class="ocr-btn ocr-btn-secondary" id="singleBackStep2">‚Üê Back to Batch</button>
                    <button class="ocr-btn ocr-btn-primary" id="singleSubmitBtn" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                        </svg>
                        Scan & Evaluate
                    </button>
                </div>
            </div>
        </section>

        <!-- ===== FULL SHEET FLOW ===== -->
        <section class="ocr-flow-section" id="fullSheetFlow" style="display: none;">
            <div class="ocr-flow-header">
                <button class="ocr-flow-back" id="fullSheetFlowBack">‚Üê Change Mode</button>
                <h2 class="ocr-section-title">Full Answer Sheet Scan</h2>
                <div class="ocr-step-indicator">
                    <span class="ocr-step active" data-step="1">1. Select Batch</span>
                    <span class="ocr-step-divider">‚Üí</span>
                    <span class="ocr-step" data-step="2">2. Upload</span>
                    <span class="ocr-step-divider">‚Üí</span>
                    <span class="ocr-step" data-step="3">3. Results</span>
                </div>
            </div>

            <!-- Step 1: Select Batch (students see questions FIRST) -->
            <div class="ocr-step-panel" id="fullSheetStep1">
                <div class="ocr-questions-builder">
                    <div class="ocr-questions-header">
                        <h3>Select Question Batch</h3>
                        <p>Choose the batch of questions for this answer sheet</p>
                    </div>
                    <div class="ocr-form-group">
                        <select id="fullSheetBatchSelect" class="ocr-input"
                            style="padding: 0.75rem; font-size: 1rem; width: 100%;">
                            <option value="">-- Loading batches... --</option>
                        </select>
                    </div>
                    <!-- Batch Preview -->
                    <div id="fullSheetBatchPreview" style="display: none; margin-top: 1rem;">
                        <div
                            style="background: #f0f4ff; border-radius: 12px; padding: 1rem; border: 1px solid #d0d8ee;">
                            <div style="font-weight: 700; color: #1e3c72; margin-bottom: 0.5rem;"
                                id="fullSheetBatchName">Batch Name</div>
                            <div
                                style="display: flex; gap: 1rem; font-size: 0.85rem; color: #666; margin-bottom: 0.75rem;">
                                <span>üìù <strong id="fullSheetBatchQCount">0</strong> Questions</span>
                                <span>üéØ <strong id="fullSheetBatchMarks">0</strong> Total Marks</span>
                            </div>
                            <div id="fullSheetBatchQuestions" style="font-size: 0.8rem; color: #555;"></div>
                        </div>
                    </div>
                </div>
                <button class="ocr-btn ocr-btn-primary ocr-btn-full" id="fullSheetNextStep1" disabled>
                    Continue to Upload Sheet ‚Üí
                </button>
            </div>

            <!-- Step 2: Upload Full Answer Sheet -->
            <div class="ocr-step-panel" id="fullSheetStep2" style="display: none;">
                <div class="ocr-upload-zone" id="fullSheetUploadZone">
                    <div class="ocr-upload-content" id="fullSheetUploadContent">
                        <div class="ocr-upload-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                                <polyline points="14,2 14,8 20,8" />
                            </svg>
                        </div>
                        <h3>Upload Full Answer Sheet</h3>
                        <p>Upload a photo of your complete answer sheet with numbered answers</p>
                        <div class="ocr-upload-tip">
                            <strong>üí° Tip:</strong> Make sure answers are clearly numbered (Q1, Q2, Ans 1, etc.)
                        </div>
                        <div class="ocr-upload-actions">
                            <button class="ocr-btn ocr-btn-primary" id="fullSheetFileBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" />
                                    <polyline points="17 8 12 3 7 8" />
                                    <line x1="12" y1="3" x2="12" y2="15" />
                                </svg>
                                Choose File
                            </button>
                            <button class="ocr-btn ocr-btn-secondary" id="fullSheetCameraBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z" />
                                    <circle cx="12" cy="13" r="4" />
                                </svg>
                                Take Photo
                            </button>
                        </div>
                    </div>
                    <div class="ocr-image-preview" id="fullSheetImagePreview" style="display: none;">
                        <img id="fullSheetPreviewImg" alt="Uploaded answer sheet" />
                        <div class="ocr-preview-overlay">
                            <button class="ocr-btn ocr-btn-small" id="fullSheetChangeImg">Change Image</button>
                        </div>
                    </div>
                </div>
                <input type="file" id="fullSheetFileInput" accept="image/*" style="display: none;">
                <input type="file" id="fullSheetCameraInput" accept="image/*" capture="environment"
                    style="display: none;">
                <div class="ocr-btn-row">
                    <button class="ocr-btn ocr-btn-secondary" id="fullSheetBackStep2">‚Üê Back to Batch</button>
                    <button class="ocr-btn ocr-btn-primary" id="fullSheetSubmitBtn" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                        </svg>
                        Scan & Evaluate All
                    </button>
                </div>
            </div>
        </section>

        <!-- ===== SCANNING OVERLAY ===== -->
        <div class="ocr-scanning-overlay" id="scanningOverlay" style="display: none;">
            <div class="ocr-scanning-card">
                <div class="ocr-scanning-animation">
                    <div class="ocr-scan-line"></div>
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <path
                            d="M1 4v-1a2 2 0 012-2h4M1 20v1a2 2 0 002 2h4M19 1h2a2 2 0 012 2v2M23 18v3a2 2 0 01-2 2h-4" />
                    </svg>
                </div>
                <h3 class="ocr-scanning-title">Scanning & Evaluating...</h3>
                <p class="ocr-scanning-status" id="scanningStatus">Reading handwritten text from your image...</p>
                <div class="ocr-scanning-progress">
                    <div class="ocr-scanning-bar" id="scanningBar"></div>
                </div>
            </div>
        </div>

        <!-- ===== RESULTS SECTION ===== -->
        <section class="ocr-results-section" id="resultsSection" style="display: none;">
            <!-- Results populated by JS -->
        </section>

    </main>

    <!-- ==================== SCRIPTS (Modular) ==================== -->
    <script src="ocr-scan-camera.js"></script>
    <script src="ocr-scan-api.js"></script>
    <script src="ocr-scan-ui.js"></script>
    <script src="ocr-scan.js"></script>
    <!-- Firebase integration for batch loading + result saving -->
    <script type="module" src="ocr-scan-batch.js"></script>
</body>

</html>